<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="media/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/images/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <title>SoleCheck</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            background-color: black;
            position: relative;
        }

        /* Background Video */
        #bgVideo {
            position: fixed;
            top: 50%;
            left: 50%;
            width: auto;
            height: auto;
            min-width: 100%;
            min-height: 100%;
            transform: translate(-50%, -50%);
            object-fit: cover;
            z-index: -1;
        }

        @media (max-width: 768px){
            #bgVideo {
                width: 150%;
                height: 150%;
            }
        }

        img {
            max-width: 300px;
            height: auto;
            margin-bottom: 40px;
            margin-top: 60px;
            z-index: 1;
        }

        button {
            font-size: 18px;
            padding: 10px 20px;
            background-color: transparent;
            color: white;
            border: 2px solid white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            z-index: 1;
        }

        button:hover {
            background-color: #5a5a5a;
        }

        button.active {
            background-color: #4B0082;
        }

        #output {
            margin-top: 30px;
            font-size: 20px;
            color: #fff;
            white-space: pre-wrap;
            text-align: center;
            z-index: 1;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }

        /* Popup Styles */
        #nfcEnabledPopup {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%); /* Centering the popup */
            width: 90%;
            height: auto;
            max-width: 500px; /* Max width for larger screens */
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7); /* Darker background */
        }

        .popup-content {
            background-color: #333;
            padding: 20px;
            border: 2px solid #fff;
            color: #fff;
            border-radius: 10px;
            text-align: center;
            width: 100%; /* Take full width of the popup */
            box-sizing: border-box; /* Include padding in the elementâ€™s total width and height */
        }

        .close {
            color: #fff;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .popup-button {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            color: white;
            background-color: transparent;
            border: 2px solid white;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
        }

        .popup-button.yes {
            background-color: #4CAF50; /* Green for 'Yes' */
        }

        .popup-button.no {
            background-color: #f44336; /* Red for 'No' */
        }

        .popup-button:hover {
            background-color: #5a5a5a; /* Darker background on hover */
        }

        /* Copyright Footer */
        footer {
            position: relative;
            bottom: 20px;
            font-size: 14px;
            color: white;
            text-align: center;
            margin-top: auto;
        }
    </style>
</head>
<body>

    <!-- Background Video -->
    <video id="bgVideo" autoplay loop muted>
        <source src="media/videos/background.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Logo Image -->
    <img src="media/images/logo.png" alt="SoleCheck Logo">
    <button id="readNfc">Verify</button>
    <div id="output">Tap Verify to get started.</div>
    <audio id="scanSound" src="media/audio/scan.mp3"></audio>

    <!-- Is NFC Enabled Popup -->
    <div id="nfcEnabledPopup">
        <div class="popup-content">
            <span class="close" aria-label="Close popup">&times;</span>
            <h2>Is NFC Enabled?</h2>
            <p>Would you like help Enabling NFC?</p>
            <a href="https://www.amazon.ca/Deodorants/b?ie=UTF8&node=6371098011" target="_blank" class="popup-button yes">Yes, please!</a>
            <button class="popup-button no" id="noNfc">No, thanks</button>
        </div>
    </div>

    <!-- Copyright Footer -->
    <footer>
        <p>&copy; Kurtis Marshall 2025. All rights reserved.</p>
    </footer>

    <script>
        // SoleCheck NFC Functionality for Serial Number
        const readNfcButton = document.getElementById('readNfc');
        const outputDiv = document.getElementById('output');
        const scanSound = document.getElementById('scanSound');

        if ('NDEFReader' in window) {
            readNfcButton.addEventListener('click', async () => {
                try {
                    const ndef = new NDEFReader();
                    outputDiv.textContent = 'Starting Shoe scan...';
                    readNfcButton.classList.add('active');

                    await ndef.scan();
                    outputDiv.textContent = 'Please tap a shoe with SoleCheck.'; 

                    ndef.onreading = (event) => {
                        scanSound.pause();
                        scanSound.currentTime = 0;
                        scanSound.play();

                        const records = event.message.records;
                        const serialNumber = event.serialNumber;  // Assuming the NFC tag's serial number is accessible here

                        if (serialNumber) {
                            outputDiv.textContent = `Serial Number: ${serialNumber}`;
                        } else {
                            outputDiv.textContent = "No serial number found on the NFC tag.";
                        }

                        if (records.length === 0) {
                            outputDiv.textContent = "No data found on the NFC tag.";
                            return;
                        }

                        const message = records.map(record => {
                            if (record.recordType === 'text') {
                                let textDecoder = new TextDecoder(record.encoding || "utf-8");
                                return textDecoder.decode(record.data);
                            } else if (record.recordType === 'url') {
                                return `URL: ${new TextDecoder().decode(record.data)}`;
                            } else {
                                return `Unsupported type: ${record.recordType}`;
                            }
                        }).join('\n');

                        outputDiv.textContent += `\n${message}`;

                        // Optionally, handle specific logic related to the serial number or data
                        if (serialNumber == '04:21:11:96:df:61:80') {
                            const VerifiedSound = new Audio('media/audio/verified.mp3');
                            VerifiedSound.play();
                            setTimeout(() => {
                                window.location.href = 'yeezyboost350.html';
                            }, 10000);
                        }
                    };

                    ndef.onreadingerror = () => {
                        outputDiv.textContent = "Failed to read NFC tag. Please try again.";
                    };
                } catch (error) {
                    outputDiv.textContent = `Shoe reading failed: ${error.message}`;
                }
            });
        } else {
            outputDiv.textContent = 'SoleCheck is not supported on this device. Try Chrome for Android.';
        }

        // Is NFC Enabled Popup Functionality
        const nfcEnabledPopup = document.getElementById("nfcEnabledPopup");
        const closeButton = document.querySelector(".close");
        const noNfcButton = document.getElementById("noNfc");

        function showNfcEnabledPopup() {
            nfcEnabledPopup.style.display = "block";
        }

        setTimeout(showNfcEnabledPopup, 5000); // 5 seconds - Now always shows

        closeButton.onclick = () => {
            nfcEnabledPopup.style.display = "none";
        };

        noNfcButton.onclick = () => {
            nfcEnabledPopup.style.display = "none";
        };

        window.onclick = (event) => {
            if (event.target == nfcEnabledPopup) {
                nfcEnabledPopup.style.display = "none";
            }
        };
    </script>
</body>
</html>
